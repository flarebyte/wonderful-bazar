'use strict'
init = require("fb-custom-init")
magma_plugin_json_file_reader = require('magma-plugin-json-file-reader')
should = require('should')
CT = require('magma-constant')
_ = require('lodash')


###
======== A Handy Little Mocha Reference ========
https://github.com/visionmedia/should.js
https://github.com/visionmedia/mocha
###

pluginEx=
  pluginId: magma_plugin_json_file_reader.PLUGIN_ID
  options:
    folder: "test/andesite"
    input:
      param: "p1"
    output:
      key: "results"

pluginExStore=
  pluginId: magma_plugin_json_file_reader.PLUGIN_ID
  options:
    folder: "test/andesite"
    input:
      param: "p1"
    output:
      key: "alpha"

ctxWithPath=
  req:
    query:
      p1: "ctx_u1"
  content:
    results: []
    store: {}

ctxWithStore=
  req:
    query:
      p1: "ctx_u1"
  content:
    results: []
    store: {}

describe 'magma-plugin-json-file-reader', ()->
  describe '#validatePlugin()', ()->

    it 'validated plugin', (done)->
      magma_plugin_json_file_reader.validatePlugin pluginEx, (e, res)->
        if e
          done(e)
        else
          res.should.be.ok
          done()

describe '#process()', ()->

  it 'populates results', (done)->
    magma_plugin_json_file_reader.process pluginEx.options,
    ctxWithPath, (e, res)->
      if e
        done(e)
      else
        expected= "magma:f/gate/773779160"
        res.content.results[0].gateId.should.eql expected
        done()

  it 'populates the store', (done)->
    magma_plugin_json_file_reader.process pluginExStore.options,
    ctxWithStore, (e, res)->
      if e
        done(e)
      else
        expected= "magma:f/gate/773779160"
        res.content.store.alpha.gateId.should.eql expected
        done()

