'use strict'
init = require("fb-custom-init")
magma_view_loader = require('magma-view-loader')
should = require('should')
CT = require('magma-constant')
_ = require('lodash')


###
======== A Handy Little Mocha Reference ========
https://github.com/visionmedia/should.js
https://github.com/visionmedia/mocha
###


describe 'magma-view-loader', ()->
  describe '#extractId()', ()->

    it 'extracts an id', ()->
      magma_view_loader.extractId("/blala/view_123456789.coffee").
      should.eql '123456789'

  describe '#hasView()', ()->

    it 'checks whether a view exist', ()->
      magma_view_loader.hasView("785703264").should.be.ok

    it 'checks whether a view does not exist', ()->
      magma_view_loader.hasView("00000000").should.be.ko

  describe '#loadView()', ()->

    it 'loads an existing view', ()->
      magma_view_loader.loadView("785703264").should.exist

    it 'does not load an unknown view', ()->
      should.not.exist magma_view_loader.loadView("0000")
  
  describe '#validateAll()', ()->

    it 'validates all the views', (done)->
      magma_view_loader.validateAll (err,result)->
        if err
          done(err)
        else
          result.should.eql "valid"
          done()

  describe '#validateAllPlugins()', ()->

    it 'validates all the plugins of views', (done)->
      magma_view_loader.validateAllPlugins (err,result)->
        if err
          done(err)
        else
          result.should.eql "valid"
          done()

